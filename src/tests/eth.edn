(defnode Main)

(def abi "
[{
\"inputs\": [
{
\"internalType\": \"uint160\",
\"name\": \"templateHash\",
\"type\": \"uint160\"
},
{
\"internalType\": \"bytes\",
\"name\": \"environment\",
\"type\": \"bytes\"
},
{
\"internalType\": \"bytes32\",
\"name\": \"cacheDirectoryCid\",
\"type\": \"bytes32\"
},
{
\"internalType\": \"uint256\",
\"name\": \"includeCost\",
\"type\": \"uint256\"
}
],
\"name\": \"update\",
\"outputs\": [],
\"stateMutability\": \"nonpayable\",
\"type\": \"function\"
}]")

(def abi2 "
[{
\"inputs\": [
{
\"internalType\": \"uint160\",
\"name\": \"templateHash\",
\"type\": \"uint160\"
},
{
\"internalType\": \"string\",
\"name\": \"tokenName\",
\"type\": \"string\"
},
{
\"internalType\": \"string\",
\"name\": \"tokenSymbol\",
\"type\": \"string\"
}
],
\"name\": \"rez\",
\"outputs\": [
{
\"internalType\": \"address\",
\"name\": \"\",
\"type\": \"address\"
}
],
\"stateMutability\": \"nonpayable\",
\"type\": \"function\"
}]")

(defchain test
  10 (BigInt) = .0 (Log)
  20 (BigInt) = .1 (Log)
  30 (BigInt) = .2 (Log)
  40 (BigInt) = .3 (Log)
  [.0 .1 .2 .3]
  (Eth.EncodeCall abi "update")
  (ToHex)
  (Log "Hex Input")
  (Assert.Is "0xd443e458000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000080001e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002800000000000000000000000000000000000000000000000000000000000000020014000000000000000000000000000000000000000000000000000000000000" true)

  "0x0000000000000000000000006b175474e89094c44da98b954eedeac495271d0f"
  (Eth.DecodeCall abi2 "rez")
  (Log "Decoded"))

(schedule Main test)
(run Main)